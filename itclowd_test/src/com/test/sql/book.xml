<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">



<mapper namespace="book">
 
<select id="indieBookList" parameterType="java.util.HashMap" resultType="com.test.book.model.IndieBookVo">
	select a.ib_no ib_no, c_no, ib_title, ib_img, avg(ia_grade) ia_grade, count(ia_grade) ia_count 
	from indie_book a left outer join indie_assessment b
	on a.ib_no = b.ib_no where 0 = 0
	<if test="cate != 0">
		and c_no = #{cate} 
	</if>
	<if test="query != 'null'">
		and ib_title like CONCAT('%',#{query},'%')
	</if>
	GROUP BY ib_no
	 limit #{startRow}, #{limit};
</select>
<select id="getListCount" parameterType="java.util.HashMap" resultType="int">
	select count(ib_no) from indie_book where 0 = 0
	<if test="cate != 0">
		and c_no = #{cate}
	</if>
	<if test="query != 'null'">
		and ib_title like CONCAT('%',#{query},'%')
	</if>
	;
</select>
<select id="indieBookDetail" parameterType="int" resultType="com.test.book.model.IndieBookVo">
	select a.ib_no ib_no, c_no, ib_title, ib_writer, ib_price, ib_date, ip_no, ib_intro, ib_page, ib_img, ib_img1, ib_img2, ib_img3, ib_size, avg(ia_grade) ia_grade, count(ia_grade) ia_count 
	from indie_book a left outer join indie_assessment b
	on a.ib_no = b.ib_no
	where a.ib_no = #{ib_no};
</select>
<insert id="insertIndieGrade" parameterType="java.util.HashMap">
	insert into indie_assessment(ib_no, m_no, ia_grade, ia_content)
	values(#{ib_no}, #{m_no}, #{ia_grade}, #{ia_content});
</insert>
</mapper>